import{a as J,b as L,c as B,d as R,e as Y,f as j,g as q,h as Z,i as H,j as K,k as G}from"./chunk-ATNCQEEW.js";import{a as T}from"./chunk-OAQJ4ZBV.js";import{B as C,C as S,D as b,E as P,F,G as f,H as D,I as z,J as o,K as r,L as k,M as v,N as g,O as d,R as W,S as m,T as _,U as A,V as y,W as M,X as w,Z as I,fa as O,ja as N,m as E,ma as $,q as c,r as p,t as V,w as a,x}from"./chunk-UVRWJICT.js";var te=2e3;function U(i){return i<10?"0"+i:String(i)}var Q=(()=>{class i{constructor(e){this.api=e,this.created=new V,this.title="",this.year=null,this.month=null,this.day=null,this.description="",this.isImportant=!1,this.saving=!1}get dateInputValue(){let e=this.month??1,n=this.day??1,t=this.year!=null&&this.year>=1&&this.year<=9999?this.year:te;return this.month==null&&this.day==null?"":`${t}-${U(e)}-${U(n)}`}onDateInput(e){let t=(e.target?.value??"").trim();if(!t){this.month=null,this.day=null;return}let s=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(!s)return;let h=parseInt(s[2],10),l=parseInt(s[3],10);h>=1&&h<=12&&l>=1&&l<=31&&(this.month=h,this.day=l)}onSubmit(){this.year===null||!this.title.trim()||this.saving||(this.saving=!0,this.api.createEvent({timelineId:this.timelineId,title:this.title.trim(),year:this.year,month:this.month??void 0,day:this.day??void 0,description:this.description.trim()||void 0,isImportant:this.isImportant}).subscribe({next:()=>{this.title="",this.year=null,this.month=null,this.day=null,this.description="",this.isImportant=!1,this.saving=!1,this.created.emit()},error:e=>{this.saving=!1,console.error(e?.error?.error||"Ereignis konnte nicht erstellt werden.")}}))}static{this.\u0275fac=function(n){return new(n||i)(x(T))}}static{this.\u0275cmp=E({type:i,selectors:[["app-event-form"]],inputs:{timelineId:"timelineId"},outputs:{created:"created"},standalone:!0,features:[I],decls:21,vars:8,consts:[["f","ngForm"],[3,"ngSubmit"],[1,"label"],["type","text","name","title","required","","placeholder","z.B. Urknall",3,"ngModelChange","ngModel"],["type","number","name","year","required","","placeholder","-13700000000 oder 2024","step","any",3,"ngModelChange","ngModel"],[1,"date-optional"],["type","date","name","date",1,"date-input",3,"input","value"],["name","description","placeholder","Kurze Beschreibung\u2026",3,"ngModelChange","ngModel"],[1,"checkbox-label"],["type","checkbox","name","isImportant",3,"ngModelChange","ngModel"],[1,"actions"],["type","submit",3,"disabled"]],template:function(n,t){if(n&1){let s=v();o(0,"form",1,0),g("ngSubmit",function(){return c(s),p(t.onSubmit())}),o(2,"label",2),m(3,"Titel"),r(),o(4,"input",3),w("ngModelChange",function(l){return c(s),M(t.title,l)||(t.title=l),p(l)}),r(),o(5,"label",2),m(6,"Jahr (v. Chr. negativ, n. Chr. positiv)"),r(),o(7,"input",4),w("ngModelChange",function(l){return c(s),M(t.year,l)||(t.year=l),p(l)}),r(),o(8,"div",5)(9,"label",2),m(10,"Datum (optional) \u2013 Picker oder manuell eingeben"),r(),o(11,"input",6),g("input",function(l){return c(s),p(t.onDateInput(l))}),r()(),o(12,"label",2),m(13,"Beschreibung (optional)"),r(),o(14,"textarea",7),w("ngModelChange",function(l){return c(s),M(t.description,l)||(t.description=l),p(l)}),r(),o(15,"label",8)(16,"input",9),w("ngModelChange",function(l){return c(s),M(t.isImportant,l)||(t.isImportant=l),p(l)}),r(),m(17," Als wichtiges Ereignis markieren "),r(),o(18,"div",10)(19,"button",11),m(20),r()()()}if(n&2){let s=W(1);a(4),y("ngModel",t.title),a(3),y("ngModel",t.year),a(4),b("value",t.dateInputValue),S("title","Kalender \xF6ffnen oder Datum eingeben (TT.MM.JJJJ)"),a(3),y("ngModel",t.description),a(2),y("ngModel",t.isImportant),a(3),b("disabled",!s.valid||t.saving),a(),_(t.saving?"Wird hinzugef\xFCgt\u2026":"Hinzuf\xFCgen")}},dependencies:[O,K,q,L,Z,J,B,R,H,j,Y],styles:["label[_ngcontent-%COMP%]{display:block}.label[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--text-secondary);margin-bottom:.25rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{margin-bottom:1rem}.checkbox-label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1rem;font-size:.9375rem;min-height:var(--touch-min);cursor:pointer;-webkit-tap-highlight-color:transparent}.checkbox-label[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:1.25rem;height:1.25rem;margin:0;flex-shrink:0}.date-optional[_ngcontent-%COMP%]{margin-bottom:.5rem}.date-optional[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{margin-bottom:.25rem}.date-input[_ngcontent-%COMP%]{width:100%;min-width:160px;box-sizing:border-box}.actions[_ngcontent-%COMP%]{margin-top:1rem}"]})}}return i})();var ne=(i,u)=>u.id;function ie(i,u){i&1&&(o(0,"p",2),m(1,"Lade Zeitstrahl\u2026"),r())}function oe(i,u){if(i&1&&(o(0,"p",3),m(1),r()),i&2){let e=d();a(),_(e.error)}}function re(i,u){if(i&1&&(o(0,"p",8),m(1),r()),i&2){let e=d(2);a(),_(e.timeline.description)}}function ae(i,u){if(i&1&&(o(0,"div",14),k(1,"span",19),r()),i&2){let e,n=d().$implicit,t=d(2);a(),P("left",(e=t.getPositionInYear(n))!==null&&e!==void 0?e:0,"%")}}function le(i,u){if(i&1&&(o(0,"p"),m(1),r()),i&2){let e=d().$implicit;a(),_(e.description)}}function me(i,u){if(i&1){let e=v();o(0,"div",11)(1,"div",12)(2,"span",13),m(3),r(),C(4,ae,2,2,"div",14),r(),o(5,"div",15)(6,"h3"),m(7),r(),C(8,le,2,1,"p"),o(9,"div",16)(10,"button",17),g("click",function(){let t=c(e).$implicit,s=d(2);return p(s.toggleImportant(t))}),m(11),r(),o(12,"button",18),g("click",function(){let t=c(e).$implicit,s=d(2);return p(s.deleteEvent(t))}),m(13,"L\xF6schen"),r()()()()}if(i&2){let e=u.$implicit,n=d(2);F("important",e.isImportant),a(3),_(n.formatDate(e)),a(),f(n.getPositionInYear(e)!==null?4:-1),a(3),_(e.title),a(),f(e.description?8:-1),a(3),A(" ",e.isImportant?"\u2605 Wichtig":"\u2606 Als wichtig markieren"," ")}}function se(i,u){if(i&1&&(o(0,"header",6),k(1,"span",7),o(2,"h1"),m(3),r(),C(4,re,2,1,"p",8),r(),o(5,"div",9),D(6,me,14,7,"div",10,ne),r()),i&2){let e=d();P("--timeline-color",e.timeline.color||"#0d6b5c"),a(3),_(e.timeline.name),a(),f(e.timeline.description?4:-1),a(),P("--timeline-color",e.timeline.color||"#0d6b5c"),a(),z(e.events)}}function de(i,u){if(i&1){let e=v();o(0,"button",20),g("click",function(){c(e);let t=d();return p(t.openModal())}),o(1,"span",21),m(2,"+"),r(),o(3,"span",22),m(4,"Hinzuf\xFCgen"),r()()}i&2&&S("aria-label","Ereignis hinzuf\xFCgen")}function ce(i,u){if(i&1){let e=v();o(0,"app-modal",23),g("closed",function(){c(e);let t=d();return p(t.closeModal())}),o(1,"app-event-form",24),g("created",function(){c(e);let t=d();return p(t.onEventCreatedAndClose())}),r()()}if(i&2){let e=d();b("isOpen",e.modalOpen),a(),b("timelineId",e.timeline.id)}}var Ee=(()=>{class i{constructor(e,n){this.route=e,this.api=n,this.timeline=null,this.events=[],this.loading=!0,this.error=null,this.modalOpen=!1,this.monthNames=["Januar","Februar","M\xE4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"]}ngOnInit(){this.route.params.subscribe(e=>{let n=e.slug;n&&this.load(n)})}load(e){this.loading=!0,this.error=null,this.api.getTimelineBySlug(e).subscribe({next:n=>{this.timeline=n,this.events=n.events||[],this.loading=!1},error:n=>{this.error=n?.error?.error||"Zeitstrahl konnte nicht geladen werden.",this.loading=!1}})}formatDate(e){let n=e.year<0?` ${Math.abs(e.year)} v. Chr.`:` ${e.year} n. Chr.`;if(e.month!=null&&e.month>=1&&e.month<=12){let t=this.monthNames[e.month-1];return e.day!=null&&e.day>=1&&e.day<=31?`${e.day}. ${t}${n}`:`${t}${n}`}return e.year<0?Math.abs(e.year)+" v. Chr.":e.year+" n. Chr."}getPositionInYear(e){if(e.month==null||e.month<1||e.month>12)return null;let n=e.day!=null&&e.day>=1&&e.day<=31?e.day:15,t=[31,29,31,30,31,30,31,31,30,31,30,31][e.month-1],s=Math.min(1,(n-1)/t),h=(e.month-1+s)/12;return Math.min(100,Math.max(0,h*100))}openModal(){this.modalOpen=!0}closeModal(){this.modalOpen=!1}onEventCreated(){this.timeline&&this.load(this.timeline.slug)}onEventCreatedAndClose(){this.closeModal(),this.onEventCreated()}toggleImportant(e){this.api.updateEvent(e.id,{isImportant:!e.isImportant}).subscribe({next:()=>{e.isImportant=!e.isImportant},error:n=>console.error(n)})}deleteEvent(e){confirm(`\u201E${e.title}" wirklich l\xF6schen?`)&&this.api.deleteEvent(e.id).subscribe({next:()=>this.onEventCreated(),error:n=>console.error(n)})}static{this.\u0275fac=function(n){return new(n||i)(x(N),x(T))}}static{this.\u0275cmp=E({type:i,selectors:[["app-timeline-detail"]],standalone:!0,features:[I],decls:8,vars:3,consts:[[1,"container"],["routerLink","/timelines",1,"back"],[1,"muted"],[1,"error"],["type","button",1,"add-fab"],["title","Ereignis hinzuf\xFCgen",3,"isOpen"],[1,"timeline-header"],[1,"dot"],[1,"desc"],[1,"timeline-visual"],[1,"event-row",3,"important"],[1,"event-row"],[1,"event-date"],[1,"date-label"],["title","Position im Jahr",1,"year-bar"],[1,"event-content"],[1,"actions-inline"],["type","button",1,"btn-small",3,"click"],["type","button",1,"btn-small","btn-secondary",3,"click"],[1,"year-marker"],["type","button",1,"add-fab",3,"click"],["aria-hidden","true",1,"add-fab-icon"],[1,"add-fab-text"],["title","Ereignis hinzuf\xFCgen",3,"closed","isOpen"],[3,"created","timelineId"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"a",1),m(2,"\u2190 Zeitstrahlen"),r(),C(3,ie,2,0,"p",2)(4,oe,2,1,"p",3)(5,se,8,6),r(),C(6,de,5,1,"button",4)(7,ce,2,2,"app-modal",5)),n&2&&(a(3),f(t.loading?3:t.error?4:t.timeline?5:-1),a(3),f(t.timeline&&!t.loading&&!t.error?6:-1),a(),f(t.timeline?7:-1))},dependencies:[O,$,Q,G],styles:['.back[_ngcontent-%COMP%]{display:inline-flex;align-items:center;margin-bottom:var(--space-md);color:var(--text-secondary);font-size:.9375rem;font-weight:500;min-height:var(--touch-min);padding:.25rem 0;-webkit-tap-highlight-color:transparent;transition:color .2s}.back[_ngcontent-%COMP%]:hover{color:var(--accent)}.timeline-header[_ngcontent-%COMP%]{margin-bottom:var(--space-xl);padding-bottom:var(--space-md);border-bottom:1px solid var(--border-light)}.dot[_ngcontent-%COMP%]{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:.6rem;vertical-align:middle;background:var(--timeline-color)}.desc[_ngcontent-%COMP%]{color:var(--text-secondary);margin-top:.35rem;font-size:.9375rem;line-height:1.5}.timeline-visual[_ngcontent-%COMP%]{margin-bottom:var(--space-xl);border-left:3px solid var(--timeline-color);margin-left:5px;padding-left:var(--space-md)}@media (min-width: 480px){.timeline-visual[_ngcontent-%COMP%]{margin-left:6px;padding-left:var(--space-lg)}}.event-row[_ngcontent-%COMP%]{padding:var(--space-md) 0;border-bottom:1px solid var(--border-light);position:relative}.event-row[_ngcontent-%COMP%]:before{content:"";position:absolute;left:calc(-1 * var(--space-md) - 5px);top:1.35rem;width:10px;height:10px;border-radius:50%;background:var(--bg-card);border:2px solid var(--timeline-color);box-sizing:border-box}.event-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.event-row.important[_ngcontent-%COMP%]   .date-label[_ngcontent-%COMP%]{font-weight:600;color:var(--accent)}.event-row.important[_ngcontent-%COMP%]:before{background:var(--timeline-color)}.event-date[_ngcontent-%COMP%]{font-size:.8125rem;font-weight:500;color:var(--text-secondary);margin-bottom:.35rem}.date-label[_ngcontent-%COMP%]{display:block;margin-bottom:.25rem}.year-bar[_ngcontent-%COMP%]{position:relative;width:100%;max-width:140px;height:6px;background:var(--border);border-radius:3px;overflow:visible}.year-marker[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translate(-50%,-50%);width:10px;height:10px;border-radius:50%;background:var(--timeline-color);box-shadow:0 0 0 2px var(--bg)}.event-content[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .3rem;font-size:1.125rem;font-weight:600;letter-spacing:-.02em}.event-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:.9375rem;color:var(--text-secondary);line-height:1.5}.actions-inline[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.6rem}.btn-small[_ngcontent-%COMP%]{font-size:.8125rem;min-height:36px;padding:.45rem .85rem;-webkit-tap-highlight-color:transparent}']})}}return i})();export{Ee as TimelineDetailComponent};
